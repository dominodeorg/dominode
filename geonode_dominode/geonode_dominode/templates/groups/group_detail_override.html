{% extends "groups/group_detail.html" %}
{% load i18n %}

{% block body_outer %}
<div class="page-header">
  <h2 class="page-title">{{ object.title|default:object.slug }}</h2>
  <p>
    {% trans "Last Modified" %}: {{ object.last_modified }}
  </p>
</div>
<div class="row">
  <div class="col-md-8 group-details">
    <div class="row">
      <div class="col-xs-4 col-md-3 group-logo">
      {% if object.logo_url %}
        <img src="{{ object.logo_url }}" alt="{{ object.title }}" />
      {% else %}
        <!-- <p>{% trans "This group has not created a logo." %}</p> -->
      {% endif %}
      </div>
      <div class="col-xs-8 col-md-9 group-details">
        <p class="group-desc">{{ object.description }}</p>
        {% if object.keyword_list %}
        <p>
          {% for keyword in object.keyword_list %}
            <span class="label label-default">{{ keyword }}</span>
          {% endfor %}
        </p>
        {% else %}
        {% endif %}
        {% if object.email %}
        <p><i class="fa fa-envelope-o"></i>
          <a href="mailto:{{ object.email }}">{{ object.email }}</a>
        </p>
        {% endif %}

        {% if object.categories.exists %}
        <p>
          {% for category in object.categories.all %}
            <a href="{{ category.get_absolute_url }}"><span class="label label-info">{{ category.name }}</span></a>
          {% endfor %}
        </p>
        {% endif %}

      </div>
    </div>
  </div>
  <div class="col-md-4">
    <ul class="list-group">
      {% if is_manager %}
      <li class="list-group-item"><a href="{% url "group_update" object.slug %}">{% trans "Edit Group Details" %}</a></li>
      <li class="list-group-item"><a href="{% url "group_members" object.slug %}">{% trans "Manage Group Members" %}</a></li>
      <li class="list-group-item"><a href="{% url "group_remove" object.slug %}">{% trans "Delete this Group" %}</a></li>
      {% endif %}
      {% if can_view %}
      <li class="list-group-item"><a href="{% url "group_activity" object.slug %}">{% trans "Group Activities" %}</a></li>
      {% endif %}
      {% if perms.geonode_dominode.execute_cli %}
      <li class="list-group-item"><a href="{% url "cli_view" object.slug %}">{% trans "Run Management Commands" %}</a></li>
      {% endif %}
      {% if perms.groups.can_sync_geoserver %}
      <li class="list-group-item"><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#sync-geoserver-modal">{% trans "Sync GeoServer" %}</button></li>
      {% endif %}
      <li class="list-group-item">
        <h4>{% trans "Permissions" %}</h4>
        <p>
          {% blocktrans with object.get_access_display as access %}
            This group is <strong>{{ access }}</strong>.
          {% endblocktrans %}
          {% if object.access == "public" %}
            {% trans "Anyone may join this group." %}
            <form class="uniForm" method="POST" action="{% url "group_join" object.slug %}">
              {% csrf_token %}
              {% if not is_member %}
              <input type="submit" class="btn btn-default btn-md btn-block" value="{% trans "Join Group" %}" />
              {% endif %}
            </form>
          {% else %} {% if object.access == "public-invite" %}
            {% trans "Anyone may view this group but membership is by invitation only." %}
          {% else %} {% if object.access == "private" %}
            {% trans "Membership is by invitation only." %}
          {% endif %} {% endif %} {% endif %}
        </p>
      </li>
      <li class="list-group-item">
        <h4>{% trans "Managers" %}</h4>
        {% for manager in object.get_managers %}
        {% with manager as profile %}
          {% include "people/_profile_about_item.html" %}
        {% endwith %}
        {% endfor %}
      </li>
    </ul>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <h4>{% trans "Members" %}</h4>
    <div class="tab-content paginate paginate-auto" id="search-content">
    {% include 'people/_profile_list_item.html' %}
    </div>
  </div>
  {% include 'search/_pagination.html' %}
</div>
<div class="modal fade" id="sync-geoserver-modal" tabindex="-1" role="dialog" aria-labelledby="sync-geoserver-label" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" style="float: left" id="sync-geoserver-label">{% trans "Sync GeoServer" %}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-dismissible fade show" role="alert">
          <div class="alert-text"></div>
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form action="{% url "cli_sync_geoserver" %}" method=post>
          {% csrf_token %}
          <div class="form-group">
            <label for="workspace-name" class="col-form-label">{% trans "Workspace Name" %}</label>
            <input type="text" class="form-control" id="workspace-name" name="workspace-name" value=""/>
            <input type="hidden" name="redirect" value="{{ request.path }}">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Run</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}


{% block extra_script %}
{{ block.super }}
<script type="text/javascript">
  $(document).ready(function(){
    let $geonode_sync_form = $('#sync-geoserver-modal form');
    let $geonode_sync_run_button = $('#sync-geoserver-modal button[type=submit]');
    $geonode_sync_run_button.on('click', function (event){
      $geonode_sync_form.submit();
    });
  });
</script>
{% endblock extra_script %}
